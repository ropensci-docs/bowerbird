<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="bowerbird">
<title>Data provenance • bowerbird</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data provenance">
<meta property="og:description" content="bowerbird">
<meta property="og:image" content="https://docs.ropensci.org/bowerbird/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">bowerbird</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.15.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../articles/bowerbird.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_provenance.html">Data provenance</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/bowerbird/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Data provenance</h1>
                        <h4 data-toc-skip class="author">Ben Raymond, Michael Sumner</h4>
            
            <h4 data-toc-skip class="date">2024-03-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/bowerbird/blob/HEAD/vignettes/data_provenance.Rmd" class="external-link"><code>vignettes/data_provenance.Rmd</code></a></small>
      <div class="d-none name"><code>data_provenance.Rmd</code></div>
    </div>

    
    
<p>Bowerbird will maintain a local collection of data files, sourced from external data providers. When one does an analysis using such files, it is useful to know <em>which</em> files were used, and the <em>provenance</em> of those files. This information will assist in making analyses reproducible.</p>
<p>Bowerbird itself actually knows very little about the data files that it maintains, particularly if it is using the <code>bb_handler_rget</code> method. In this case, for a given data source it typically knows the URL and flags to pass to <code>bb_rget</code>, and some basic metadata (primarily intended to be read by the user). This is by design: the heavy lifting involved in mirroring a remote data source is generally handballed <code>bb_rget</code>. This simplifies both the bowerbird code as well as the process of writing and maintaining data sources.</p>
<p>The downside of this is that bowerbird can’t necessarily answer questions about data provenance in specific detail. Say that we are using data from a data source that contains many separate files, one per day, spanning many years, and we run an analysis that uses only files from the year 1999. Ideally we would like a function that could tell us exactly which files from the complete data set are needed for our particular analysis, but this is impossible without specific knowledge of how the data source is structured. Analogous situations exist with data sources that split geographic space across files, or split different parameters across files.</p>
<p>Despite this, bowerbird can provide some general information to assist with data provenance issues.</p>
<div class="section level2">
<h2 id="which-files-were-used-in-an-analysis">Which files were used in an analysis<a class="anchor" aria-label="anchor" href="#which-files-were-used-in-an-analysis"></a>
</h2>
<p>Say we have a bowerbird config:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/bowerbird">bowerbird</a></span><span class="op">)</span></span>
<span><span class="va">cf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bb_config.html">bb_config</a></span><span class="op">(</span><span class="st">"/some/local/path"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/bb_add.html">bb_add</a></span><span class="op">(</span><span class="fu"><a href="../reference/bb_example_sources.html">bb_example_sources</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can ask bowerbird where these files are stored locally:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">source_dirs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bb_data_source_dir.html">bb_data_source_dir</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">cf</span><span class="op">$</span><span class="va">data_sources</span><span class="op">$</span><span class="va">name</span>, source_dir <span class="op">=</span> <span class="va">source_dirs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="34%">
<col width="65%">
</colgroup>
<thead><tr class="header">
<th align="left">name</th>
<th align="left">source_dir</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NOAA OI SST V2</td>
<td align="left">/some/local/path/ftp.cdc.noaa.gov/Datasets/noaa.oisst.v2/</td>
</tr>
<tr class="even">
<td align="left">Australian Election 2016 House of Representatives data</td>
<td align="left">/some/local/path/results.aec.gov.au/20499/Website/</td>
</tr>
<tr class="odd">
<td align="left">CMEMS global gridded SSH reprocessed (1993-ongoing)</td>
<td align="left">/some/local/path/ftp.sltac.cls.fr/Core/SEALEVEL_GLO_PHY_L4_REP_OBSERVATIONS_008_047/dataset-duacs-rep-global-merged-allsat-phy-l4-v3/</td>
</tr>
<tr class="even">
<td align="left">Oceandata SeaWiFS Level-3 mapped monthly 9km chl-a</td>
<td align="left">/some/local/path/oceandata.sci.gsfc.nasa.gov/SeaWiFS/Mapped</td>
</tr>
<tr class="odd">
<td align="left">Sea Ice Trends and Climatologies from SMMR and SSM/I-SSMIS, Version 3</td>
<td align="left">/some/local/path/daacdata.apps.nsidc.org/pub/DATASETS/nsidc0192_seaice_trends_climo_v3/</td>
</tr>
<tr class="even">
<td align="left">Bathymetry of Lake Superior</td>
<td align="left">/some/local/path/www.ngdc.noaa.gov/mgg/greatlakes/superior/data/</td>
</tr>
</tbody>
</table>
<p>The directory for each data source will contain <em>all</em> of the files associated with that data source, not just the files used in a particular analysis. (In extreme cases this directory might even contain files from other data sources, although this should only happen if multiple data sources have overlapping <code>source_url</code> paths, which ought not to be a common occurrence.)</p>
<p>So while this directory is not the <em>minimal</em> set of files needed to reproduce an analysis, it does at least contain that set, and could be used to store those files in an online repository that assigns DOIs (such as figshare, see <a href="https://cran.r-project.org/package=rfigshare" class="external-link uri">https://cran.r-project.org/package=rfigshare</a>, or zenodo), or bundle into a docker image (see e.g <a href="https://github.com/o2r-project/containerit" class="external-link uri">https://github.com/o2r-project/containerit</a>).</p>
<p>The complete list of files within a data source’s directory can be generated using a standard directory listing (e.g. <code>list.files(path = my_source_dir, recursive = TRUE</code>), but see also the <code>bb_fingerprint</code> function described below, which provides additional information about the files.</p>
<div class="section level3">
<h3 id="refining-the-list-of-files">Refining the list of files<a class="anchor" aria-label="anchor" href="#refining-the-list-of-files"></a>
</h3>
<p>Ascertaining exactly which files were used in a particular analysis is a task that is better handled by the code being used to do the file-reading and analysis, not by the repository-management (bowerbird) code.</p>
<p>We are unaware of any general solutions that will keep track of the files used by an arbitrary chunk of R code.</p>
<p>The recordr package (<a href="https://github.com/NCEAS/recordr" class="external-link uri">https://github.com/NCEAS/recordr</a>) comes close: it will collect info about which files were read or written. However, this only works for file types that have read functions implemented in recordr. At the time of writing, this does not cover netcdf files or other files typically used for environmental data, and so its application in that domain is likely to be of limited value.</p>
<p>Packages that provide specific data access functionality (e.g. <a href="https://github.com/AustralianAntarcticDivision/raadtools" class="external-link uri">https://github.com/AustralianAntarcticDivision/raadtools</a>) might provide mechanisms for tracking which data files are needed in order to fulfil particular data queries.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-provenance-of-files-used-in-an-analysis">The provenance of files used in an analysis<a class="anchor" aria-label="anchor" href="#the-provenance-of-files-used-in-an-analysis"></a>
</h2>
<p>Provenance: where the files came from, when they were downloaded, their version, etc.</p>
<p>The <code>bb_fingerprint</code> function, given a data repository configuration, will return the timestamp of download and hashes of all files associated with its data sources. Thus, for all of these files, we have established where they came from (the data source ID), when they were downloaded, and a hash so that later versions of those files can be compared to detect changes.</p>
<div class="section level3">
<h3 id="a-word-on-digital-object-identifiers">A word on digital object identifiers<a class="anchor" aria-label="anchor" href="#a-word-on-digital-object-identifiers"></a>
</h3>
<p>When a data source is defined, it should have used its DOI as its data source ID (if it has a DOI, otherwise some other unique identifier). The idea of a DOI is that a data set that has a DOI should be peristent (accessible for long term use), and the DOI should uniquely identify the data resource that it is assigned to. When a data set changes in a substantial manner, and/or it is necessary to identify both the original and the changed material, a new DOI should be assigned. Thus, knowing the DOI gives some indication of the data provenance.</p>
<p>However, it is worth noting that the DOI might not uniquely identify the state of the data source. For example, the NSIDC SMMR-SSM/I Nasateam near-real-time sea ice concentration data set (DOI <a href="http://doi.org/10.5067/U8C09DWVX9LM" class="external-link uri">http://doi.org/10.5067/U8C09DWVX9LM</a>) is updated each day (new files are added) as new data is acquired by the satellites. At periodic intervals, these files are subjected to more rigorous quality control and post-processing, and then moved into a different data set (<a href="http://doi.org/10.5067/8GQ8LZQVL0VL" class="external-link uri">http://doi.org/10.5067/8GQ8LZQVL0VL</a>). Thus, knowing the DOI of the near-real-time data set does not uniquely identify the files that were included in that data set at a given point in time.</p>
<p>Similar ambiguity can arise for other reasons, including data corrections. Say that one data file within a large collection was found to have errors and was corrected: it is at the discretion of the data provider whether the data set as a whole receives a new DOI because of this change.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
